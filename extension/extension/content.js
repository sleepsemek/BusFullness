/*! For license information please see content.js.LICENSE.txt */
(()=>{"use strict";var e={"./src/api/busLoad.js":(e,t,r)=>{r.r(t),r.d(t,{fetchBusLoadByDirection:()=>o,fetchBusLoadById:()=>n});var a=r("./src/constants.js");function n(e){return fetch("".concat(a.baseURL,"/bus/").concat(e)).then(function(e){if(!e.ok)throw new Error("\u041e\u0448\u0438\u0431\u043a\u0430, \u0441\u0442\u0430\u0442\u0443\u0441 ".concat(e.status));return e.json()})}function o(e){return fetch("".concat(a.baseURL,"/bus/").concat(e)).then(function(e){if(!e.ok)throw new Error("\u041e\u0448\u0438\u0431\u043a\u0430, \u0441\u0442\u0430\u0442\u0443\u0441 ".concat(e.status));return e.json()})}},"./src/constants.js":(e,t,r)=>{function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,o,s,c=[],i=!0,l=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;i=!1}else for(;!(i=(a=o.call(r)).done)&&(c.push(a.value),c.length!==t);i=!0);}catch(e){l=!0,n=e}finally{try{if(!i&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(l)throw n}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=Array(t);r<t;r++)a[r]=e[r];return a}r.r(t),r.d(t,{baseURL:()=>u,cardClassNameSelectors:()=>l,cardClassNames:()=>i,coursePageElementSelectors:()=>c,routePageElementSelectors:()=>s,transportTypeMap:()=>d});var s={header:"div._1sv3x8qq[data-direction-id], div._6xulm8t[data-direction-id]",station:"div._15nfxwn",activeTime:"._mgulo2d, ._psoawlx"},c={list:"._awwm2v",cardContent:"._1a1fu9m"},i={card:"gis-bus-card",cardHeader:"bus-header",cardHeaderText:"bus-header-text",cardLoadIndicator:"load-indicator",cardLoadBar:"load-bars",cardLoadZoneBackground:"load-zone",cardLoadZoneForeground:"load-zone-foreground",tooltipClassNames:{tooltip:"load-tooltip",tooltipTitle:"tooltip-title",tooltipZones:"tooltip-zones",tooltipZone:"tooltip-zone",tooltipZoneLabel:"zone-label",tooltipZoneBarContainer:"zone-bar-container",tooltipZoneBarFill:"zone-fill",tooltipZonePercentage:"zone-percent"},cardDescriptionContainer:"zone-description-container",cardDescription:"zone-description",cardLoadBadgeWrapper:"gis-course-load-badge-wrapper",cardLoadBadge:"load-badge",cardLoadBadgeCourse:"load-badge load-badge--course",cardFooter:"load-footer"},l=function e(t){for(var r={},o=0,s=Object.entries(t);o<s.length;o++){var c=n(s[o],2),i=c[0],l=c[1];"object"===a(l)&&null!==l?r[i]=e(l):r[i]=".".concat(l)}return r}(i),d={bus:"\u0410\u0432\u0442\u043e\u0431\u0443\u0441",trolleybus:"\u0422\u0440\u043e\u043b\u043b\u0435\u0439\u0431\u0443\u0441",tram:"\u0422\u0440\u0430\u043c\u0432\u0430\u0439",shuttle_bus:"\u041c\u0430\u0440\u0448\u0440\u0443\u0442\u043a\u0430"},u="http://localhost:3000"},"./src/observer.js":(e,t,r)=>{function a(){try{var e=document.createElement("script");e.src=chrome.runtime.getURL("inject.js"),e.onload=function(){e.remove()},(document.head||document.documentElement).appendChild(e)}catch(e){console.warn("inject failed",e)}}r.r(t),r.d(t,{injectScript:()=>a})},"./src/ui/badge.js":(e,t,r)=>{function a(e,t){var r=n(t),a=r.status,o=r.text,s=r.className;e.className="load-badge ".concat(s),e.textContent=o,e.dataset.status=a}function n(e){return e<.2?{status:"empty",text:"\u043f\u0443\u0441\u0442\u043e\u0439",className:"empty"}:e<.3?{status:"light",text:"\u0441\u0432\u043e\u0431\u043e\u0434\u043d\u044b\u0439",className:"light"}:e<.6?{status:"medium",text:"\u0441\u0440\u0435\u0434\u043d\u0438\u0439",className:"medium"}:e<.7?{status:"crowded",text:"\u043c\u043d\u043e\u0433\u043e\u043b\u044e\u0434\u043d\u044b\u0439",className:"crowded"}:e<.9?{status:"full",text:"\u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043d\u044b\u0439",className:"full"}:{status:"overcrowded",text:"\u043f\u0435\u0440\u0435\u043f\u043e\u043b\u043d\u0435\u043d\u043d\u044b\u0439",className:"overcrowded"}}r.r(t),r.d(t,{getLoadStatus:()=>n,updateBadge:()=>a})},"./src/ui/render.js":(e,t,r)=>{r.r(t),r.d(t,{insertRouteContainers:()=>i});var a=r("./src/ui/routeCard.js"),n=r("./src/utils/groupBy.js"),o=r("./src/constants.js");function s(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return c(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,i=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){i=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(i)throw o}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=Array(t);r<t;r++)a[r]=e[r];return a}function i(e){var t=Array.from(document.querySelectorAll(o.routePageElementSelectors.header));if(t.length)for(var r=e?(0,n.groupByDirection)(e.devices||[]):new Map,a=0,s=t;a<s.length;a++){var c=s[a],i=String(c.dataset.directionId).trim(),d=c.nextSibling,u=r.get(i);u&&l(d,i,u)}}function l(e,t,r){var n=Array.from(e.querySelectorAll(o.routePageElementSelectors.station)),c=[],i=-1,l=0,d=0,u=n[0].firstElementChild.firstElementChild.style.backgroundColor;if(!r||!r.length)return c.push.apply(c,n),void C(c);for(var m=0,p=n;m<p.length;m++){var f=p[m],y=f.querySelector(o.routePageElementSelectors.activeTime);if(y){var v=parseInt(y.textContent.replace(" \u043c\u0438\u043d","").trim()),g=r[d];if(g){if(l>=3||-1===i||v<i){var b,h=!(null===(b=f.previousElementSibling)||void 0===b||!b.classList.contains(o.cardClassNames.card))&&f.previousElementSibling;h?(0,a.updateCard)(h,g):f.parentNode.insertBefore((0,a.drawCard)(g,u),f),i=v,d++}else i=v,c.push(f);l=0}else c.push(f)}else c.push(f),l++}function C(e){var t,r=s(e);try{for(r.s();!(t=r.n()).done;){var a,n=t.value.previousElementSibling;null!==(a=null==n?void 0:n.classList.contains(o.cardClassNames.card))&&void 0!==a&&a&&n.remove()}}catch(e){r.e(e)}finally{r.f()}}C(c)}},"./src/ui/routeCard.js":(e,t,r)=>{r.r(t),r.d(t,{drawCard:()=>d,updateCard:()=>u});var a=r("./src/ui/badge.js"),n=r("./src/ui/tooltip.js"),o=r("./src/api/busLoad.js"),s=r("./src/utils/colors.js"),c=r("./src/constants.js");function i(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return l(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=Array(t);r<t;r++)a[r]=e[r];return a}function d(e,t){var r=document.createElement("div");r.className=c.cardClassNames.card,r.dataset.directionId=e.direction_id,r.dataset.deviceId=e.device_id;var a=Object.assign(document.createElement("div"),{className:c.cardClassNames.cardHeader}),n=Object.assign(document.createElement("div"),{className:c.cardClassNames.cardLoadIndicator}),s=Object.assign(document.createElement("div"),{className:c.cardClassNames.cardHeaderText,textContent:"".concat(c.transportTypeMap[e.transport_type]," ").concat(e.route_name)});a.append(n,s);var i=Object.assign(document.createElement("div"),{className:c.cardClassNames.cardLoadBar}),l=Object.assign(document.createElement("div"),{className:c.cardClassNames.cardLoadZoneBackground}),d=Object.assign(document.createElement("div"),{className:c.cardClassNames.cardLoadZoneForeground});l.appendChild(d),i.appendChild(l);var u=Object.assign(document.createElement("div"),{className:c.cardClassNames.tooltipClassNames.tooltip,textContent:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435..."});i.appendChild(u);var f=Object.assign(document.createElement("div"),{className:c.cardClassNames.cardDescriptionContainer}),y=Object.assign(document.createElement("div"),{className:c.cardClassNames.cardDescription,textContent:"\u0417\u0430\u0433\u0440\u0443\u0436\u0435\u043d\u043d\u043e\u0441\u0442\u044c:"}),v=Object.assign(document.createElement("div"),{className:c.cardClassNames.cardLoadBadge,textContent:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430..."});f.append(y,v);var g=Object.assign(document.createElement("div"),{className:c.cardClassNames.cardFooter});return g.textContent="\u0423\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u043e: ".concat(e.device_id),(0,o.fetchBusLoadById)(e.device_id).then(function(e){p(l,e),m(v,u,e)}),r.append(a,i,f,g),r.style.setProperty("--bus-line-color",t),r}function u(e,t){e.dataset.directionId=t.direction_id,e.dataset.deviceId=t.device_id;var r=e.querySelector(c.cardClassNameSelectors.cardHeaderText);r&&(r.textContent="".concat(c.transportTypeMap[t.transport_type]," ").concat(t.route_name));var a=e.querySelector(c.cardClassNameSelectors.cardLoadZoneBackground),n=e.querySelector(c.cardClassNameSelectors.cardLoadBadge),s=e.querySelector(c.cardClassNameSelectors.tooltipClassNames.tooltip),i=e.querySelector(c.cardClassNameSelectors.cardFooter);i&&(i.textContent="\u0423\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u043e: ".concat(t.device_id)),(0,o.fetchBusLoadById)(t.device_id).then(function(e){p(a,e),m(n,s,e)})}function m(e,t,r){if(r.length){var o=r.reduce(function(e,t){return e+t},0)/r.length;(0,a.updateBadge)(e,o),(0,n.updateTooltip)(t,r)}}function p(e,t){if(t.length){var r=Math.min.apply(Math,i(t)),a=t.reduce(function(e,t){return e+t},0)/t.length,n=(0,s.loadToColor)(r),o=(0,s.loadToColor)(a),l=e.querySelector(c.cardClassNameSelectors.cardLoadZoneForeground),d="radial-gradient(circle at center,\n        ".concat(o," 30%,\n        ").concat(n," 100%\n    )");l.style.backgroundImage=d,l.style.opacity="0.8",setTimeout(function(){e.style.backgroundImage=d,l.style.opacity="0"},1e3)}}},"./src/ui/tooltip.js":(e,t,r)=>{r.r(t),r.d(t,{updateTooltip:()=>o});var a=r("./src/constants.js"),n=r("./src/utils/colors.js");function o(e,t){var r=["\u0417\u0430\u0434\u043d\u044f\u044f","\u0421\u0440\u0435\u0434\u043d\u044f\u044f","\u041f\u0435\u0440\u0435\u0434\u043d\u044f\u044f"],o=Object.assign(document.createElement("div"),{className:a.cardClassNames.tooltipClassNames.tooltipTitle,textContent:"\u0417\u0430\u0433\u0440\u0443\u0436\u0435\u043d\u043d\u043e\u0441\u0442\u044c \u043f\u043e \u0437\u043e\u043d\u0430\u043c"}),s=Object.assign(document.createElement("div"),{className:a.cardClassNames.tooltipClassNames.tooltipZones});t.forEach(function(e,t){var o=Object.assign(document.createElement("div"),{className:a.cardClassNames.tooltipClassNames.tooltipZone}),c=Object.assign(document.createElement("div"),{className:a.cardClassNames.tooltipClassNames.tooltipZoneLabel,textContent:r[t]}),i=Object.assign(document.createElement("div"),{className:a.cardClassNames.tooltipClassNames.tooltipZoneBarContainer}),l=Object.assign(document.createElement("div"),{className:a.cardClassNames.tooltipClassNames.tooltipZoneBarFill,style:"width: ".concat(100*e,"%; background: ").concat((0,n.loadToColor)(e))}),d=Object.assign(document.createElement("div"),{className:a.cardClassNames.tooltipClassNames.tooltipZonePercentage,textContent:"".concat(Math.round(100*e),"%")});i.appendChild(l),o.append(c,i,d),s.appendChild(o)}),e.innerHTML="",e.append(o,s)}},"./src/utils/colors.js":(e,t,r)=>{function a(e){var t=Math.max(0,Math.min(1,e)),r=Math.round(120*(1-t));return"hsl(".concat(r,", 70%, 45%)")}r.r(t),r.d(t,{loadToColor:()=>a})},"./src/utils/groupBy.js":(e,t,r)=>{function a(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0,o=function(){};return{s:o,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,c=!0,i=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){i=!0,s=e},f:function(){try{c||null==r.return||r.return()}finally{if(i)throw s}}}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=Array(t);r<t;r++)a[r]=e[r];return a}function o(e){var t,r=new Map,n=a(e);try{for(n.s();!(t=n.n()).done;){var o=t.value,s=String(o.direction_id).trim();r.has(s)||r.set(s,[]),r.get(s).push(o)}}catch(e){n.e(e)}finally{n.f()}return r}r.r(t),r.d(t,{groupByDirection:()=>o})}},t={};function r(a){var n=t[a];if(void 0!==n)return n.exports;var o=t[a]={exports:{}};return e[a](o,o.exports,r),o.exports}r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var a={};(()=>{r.r(a);var e=r("./src/observer.js"),t=r("./src/ui/render.js"),n=null,o=null;window.addEventListener("message",function(e){if(e.source===window){var r=e.data;if(r)switch(r.type){case"ROUTE_RESPONSE":try{n=r.payload,(0,t.insertRouteContainers)(n)}catch(e){console.error("prepareRouteContainers error",e)}break;case"ROUTING_API_RESPONSE":try{o=r.payload,setTimeout(function(){(0,t.renderCourse)(o)},200)}catch(e){console.error("prepareCourseContainers error",e)}}}},!1),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e.injectScript):(0,e.injectScript)()})()})();
//# sourceMappingURL=content.js.map