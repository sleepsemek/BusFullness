# BusFullness

**BusFullness** — система для анализа загруженности общественного транспорта.  
Включает серверную часть (API для получения и записи данных), ML-модель для оценки плотности пассажиров по видеопотоку
на ESP32 и расширение браузера для отображения данных пользователю.

---

## Архитектура

Проект состоит из нескольких подсистем:

| Каталог           | Назначение                                                                                                                  |
|-------------------|-----------------------------------------------------------------------------------------------------------------------------|
| **`api/`**        | Backend-сервис на FastAPI. Принимает данные с камер, сохраняет в PostgreSQL и предоставляет API для фронтенда               |
| **`ml/`**         | Jupyter-ноутбук и для обучения модели, подходящей для ESP32, определяющей заполненность автобуса по кадрам с камер. Пример кода прошивки для ESP32  |
| **`extensions/`** | Расширение Chrome, отображающее загруженность маршрутов и автобусов в реальном времени                                      |

**Подробная документация по каждому сервису** находится в его папке:

- [api/README.md](./api/README.md)
- [ml/README.md](./ml/README.md)
- [extensions/README.md](./extensions/README.md)

---

## Быстрый старт

1. Скопируйте шаблон окружения:
   ```bash
   cp .env.example .env
   ```

2. Укажите свои настройки (БД, порты и т.д.)

3. Убедитесь, что установлены необходимые инструменты:
    - `make` — для запуска инфраструктуры
    - зависимости из `requirements.txt` — для миграций и вспомогательных скриптов

4. Запустите инфраструктуру:
   ```bash
   make startup
   ```

5. После успешного запуска:
    - API доступно по адресу: [http://localhost:8000/docs](http://localhost:8000/docs)
    - PostgreSQL доступна локально на порту, указанном в `.env`

---

## Makefile команды

- `make core` — запустить только Postgres
- `make build` — собрать сервис `bus-api`
- `make up` — запустить API (и Postgres если не запущен)
- `make down` — остановить и удалить контейнеры
- `make ps` — список контейнеров
- `make logs` — логи сервисов
- `make migrate` — применить миграции
- `make rollback` — откатить одну миграцию
- `make migrate_reload` — полный цикл
- `make startup` — полный запуск + миграции
